# Maintainer: Vladimír Vondruš <mosra@centrum.cz>
pkgname=c6run
_pkgbase=C6Run_0_98_03_03
pkgver=0.98.03.03
pkgrel=1
pkgdesc="Easy DSP development for TI DSP+ARM devices"
arch=('i686' 'x86_64')
url="https://gforge.ti.com/gf/project/dspeasy"
license=('BSD')
depends=('ti-cgt-c6000' 'arm-none-linux-gnueabi')
options=(!buildflags !makeflags)
source=(${_pkgbase}.tar.gz
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/lpm/1_24_02_09/exports/local_power_manager_linux_1_24_02_09.tar.gz
    http://software-dl.ti.com/dsps/dsps_public_sw/DSPLink/1_65/1_65_00_03/1.65.00.03/dsplink_linux_1_65_00_03.tar.gz
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/linuxutils/3_21_00_04/exports/linuxutils_3_21_00_04.tar.gz
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/bios/dspbios/5_41_10_36/exports/bios_setuplinux_5_41_10_36.bin
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/ipc/1_23_03_31/exports/ipc_setuplinux_1_23_03_31.bin
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/bios/sysbios/6_32_01_38/exports/bios_setuplinux_6_32_01_38.bin
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/syslink/2_00_02_80/exports/syslink_2_00_02_80.tar.gz
    http://software-dl.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/rtsc/3_22_01_21/exports/xdctools_setuplinux_3_15_01_59.bin)
noextract=(local_power_manager_linux_1_24_02_09.tar.gz
    dsplink_linux_1_65_00_03.tar.gz
    linuxutils_3_21_00_04.tar.gz
    syslink_2_00_02_80.tar.gz)
md5sums=('1274fd39c508ae40fd6d4f7ff20e0744'
         '3d05453df26dfc811de04839d74c2f2b'
         '1bda596b631bd2f517edc70f6be4f2ca'
         'bf17113d117796ce7ebf75d674faf03f'
         'a8df6bb97005b167fd10f4d6bd300f2f'
         '5f3bc7da44a0335366ced7ab4243fa21'
         '7b507f2abc1a0c74f7511e61716814d3'
         '7f052e759b300d54f070900d5115297e'
         'c7cd094cdc49459018b6f0e1eb95af30')


build() {
    # Fix fucked-up permissions
    chmod -R +w "$srcdir"

    # Link already downloaded files
    cd "$srcdir"
    mkdir -p $_pkgbase/downloads
    ln -s "$srcdir"/*.tar.gz "$srcdir"/*.bin $_pkgbase/downloads/

    # Install them
    cd $_pkgbase
    make get_components

    # Make configuration
    make DSP_REGION_BASE_ADDR=0x86300000 \
        DSP_REGION_CMEM_SIZE=0x01000000 \
        DSP_REGION_CODE_SIZE=0x00D00000 \
            beagleboard_config

    # Make DSP and GPP libraries
    make dsp_libs
    make gpp_libs
}

package() {
    error "This software is so damn fucked up that it needs to shit into its own files, so it CANNOT be installed. Use \`${srcdir}/${_pkgbase}\` as CODEGEN_INSTALL_DIR in all your attempts to create a better world."

    cd "$srcdir/$_pkgbase"
    cp -r bin/ include/ lib/ c6run-environment.sh "$pkgdir"

    msg2 "You can archive the generated pkg/ directory and use it as backup for times when somethings fucks up really bad."

    false
}
